### ğŸ“º è§†é¢‘é¢˜è§£

![42. æ¥é›¨æ°´.mp4](https://leetcode.cn/problems/trapping-rain-water/solution/jie-yu-shui-by-leetcode-solution-tuvc/21f6ec58-ab28-4e14-9fd0-bcd7d68f35b1)

### ğŸ“– æ–‡å­—é¢˜è§£

#### æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’

å¯¹äºä¸‹æ ‡ $i$ï¼Œä¸‹é›¨åæ°´èƒ½åˆ°è¾¾çš„æœ€å¤§é«˜åº¦ç­‰äºä¸‹æ ‡ $i$ ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦çš„æœ€å°å€¼ï¼Œä¸‹æ ‡ $i$ å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äºä¸‹æ ‡ $i$ å¤„çš„æ°´èƒ½åˆ°è¾¾çš„æœ€å¤§é«˜åº¦å‡å» $\textit{height}[i]$ã€‚

æœ´ç´ çš„åšæ³•æ˜¯å¯¹äºæ•°ç»„ $\textit{height}$ ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«å‘å·¦å’Œå‘å³æ‰«æå¹¶è®°å½•å·¦è¾¹å’Œå³è¾¹çš„æœ€å¤§é«˜åº¦ï¼Œç„¶åè®¡ç®—æ¯ä¸ªä¸‹æ ‡ä½ç½®èƒ½æ¥çš„é›¨æ°´é‡ã€‚å‡è®¾æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ä¸º $n$ï¼Œè¯¥åšæ³•éœ€è¦å¯¹æ¯ä¸ªä¸‹æ ‡ä½ç½®ä½¿ç”¨ $O(n)$ çš„æ—¶é—´å‘ä¸¤è¾¹æ‰«æå¹¶å¾—åˆ°æœ€å¤§é«˜åº¦ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n^2)$ã€‚

ä¸Šè¿°åšæ³•çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜æ˜¯å› ä¸ºéœ€è¦å¯¹æ¯ä¸ªä¸‹æ ‡ä½ç½®éƒ½å‘ä¸¤è¾¹æ‰«æã€‚å¦‚æœå·²ç»çŸ¥é“æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ï¼Œåˆ™å¯ä»¥åœ¨ $O(n)$ çš„æ—¶é—´å†…å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ $O(n)$ çš„æ—¶é—´å†…é¢„å¤„ç†å¾—åˆ°æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ã€‚

åˆ›å»ºä¸¤ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ã€‚å¯¹äº $0 \le i<n$ï¼Œ$\textit{leftMax}[i]$ è¡¨ç¤ºä¸‹æ ‡ $i$ åŠå…¶å·¦è¾¹çš„ä½ç½®ä¸­ï¼Œ$\textit{height}$ çš„æœ€å¤§é«˜åº¦ï¼Œ$\textit{rightMax}[i]$ è¡¨ç¤ºä¸‹æ ‡ $i$ åŠå…¶å³è¾¹çš„ä½ç½®ä¸­ï¼Œ$\textit{height}$ çš„æœ€å¤§é«˜åº¦ã€‚

æ˜¾ç„¶ï¼Œ$\textit{leftMax}[0]=\textit{height}[0]$ï¼Œ$\textit{rightMax}[n-1]=\textit{height}[n-1]$ã€‚ä¸¤ä¸ªæ•°ç»„çš„å…¶ä½™å…ƒç´ çš„è®¡ç®—å¦‚ä¸‹ï¼š

- å½“ $1 \le i \le n-1$ æ—¶ï¼Œ$\textit{leftMax}[i]=\max(\textit{leftMax}[i-1], \textit{height}[i])$ï¼›

- å½“ $0 \le i \le n-2$ æ—¶ï¼Œ$\textit{rightMax}[i]=\max(\textit{rightMax}[i+1], \textit{height}[i])$ã€‚

å› æ­¤å¯ä»¥æ­£å‘éå†æ•°ç»„ $\textit{height}$ å¾—åˆ°æ•°ç»„ $\textit{leftMax}$ çš„æ¯ä¸ªå…ƒç´ å€¼ï¼Œåå‘éå†æ•°ç»„ $\textit{height}$ å¾—åˆ°æ•°ç»„ $\textit{rightMax}$ çš„æ¯ä¸ªå…ƒç´ å€¼ã€‚

åœ¨å¾—åˆ°æ•°ç»„ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ çš„æ¯ä¸ªå…ƒç´ å€¼ä¹‹åï¼Œå¯¹äº $0 \le i<n$ï¼Œä¸‹æ ‡ $i$ å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº $\min(\textit{leftMax}[i],\textit{rightMax}[i])-\textit{height}[i]$ã€‚éå†æ¯ä¸ªä¸‹æ ‡ä½ç½®å³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

åŠ¨æ€è§„åˆ’åšæ³•å¯ä»¥ç”±ä¸‹å›¾ä½“ç°ã€‚

![fig1](https://assets.leetcode-cn.com/solution-static/42/1.png)

* [sol1-Java]

```Java
class Solution {
    public int trap(int[] height) {
        int n = height.length;
        if (n == 0) {
            return 0;
        }

        int[] leftMax = new int[n];
        leftMax[0] = height[0];
        for (int i = 1; i < n; ++i) {
            leftMax[i] = Math.max(leftMax[i - 1], height[i]);
        }

        int[] rightMax = new int[n];
        rightMax[n - 1] = height[n - 1];
        for (int i = n - 2; i >= 0; --i) {
            rightMax[i] = Math.max(rightMax[i + 1], height[i]);
        }

        int ans = 0;
        for (int i = 0; i < n; ++i) {
            ans += Math.min(leftMax[i], rightMax[i]) - height[i];
        }
        return ans;
    }
}
```

* [sol1-Golang]

```go
func trap(height []int) (ans int) {
    n := len(height)
    if n == 0 {
        return
    }

    leftMax := make([]int, n)
    leftMax[0] = height[0]
    for i := 1; i < n; i++ {
        leftMax[i] = max(leftMax[i-1], height[i])
    }

    rightMax := make([]int, n)
    rightMax[n-1] = height[n-1]
    for i := n - 2; i >= 0; i-- {
        rightMax[i] = max(rightMax[i+1], height[i])
    }

    for i, h := range height {
        ans += min(leftMax[i], rightMax[i]) - h
    }
    return
}

func min(a, b int) int {
    if a < b {
        return a
    }
    return b
}

func max(a, b int) int {
    if a > b {
        return a
    }
    return b
}
```

* [sol1-JavaScript]

```JavaScript
var trap = function(height) {
    const n = height.length;
    if (n == 0) {
        return 0;
    }

    const leftMax = new Array(n).fill(0);
    leftMax[0] = height[0];
    for (let i = 1; i < n; ++i) {
        leftMax[i] = Math.max(leftMax[i - 1], height[i]);
    }

    const rightMax = new Array(n).fill(0);
    rightMax[n - 1] = height[n - 1];
    for (let i = n - 2; i >= 0; --i) {
        rightMax[i] = Math.max(rightMax[i + 1], height[i]);
    }

    let ans = 0;
    for (let i = 0; i < n; ++i) {
        ans += Math.min(leftMax[i], rightMax[i]) - height[i];
    }
    return ans;
};
```

* [sol1-Python3]

```Python
class Solution:
    def trap(self, height: List[int]) -> int:
        if not height:
            return 0
        
        n = len(height)
        leftMax = [height[0]] + [0] * (n - 1)
        for i in range(1, n):
            leftMax[i] = max(leftMax[i - 1], height[i])

        rightMax = [0] * (n - 1) + [height[n - 1]]
        for i in range(n - 2, -1, -1):
            rightMax[i] = max(rightMax[i + 1], height[i])

        ans = sum(min(leftMax[i], rightMax[i]) - height[i] for i in range(n))
        return ans
```

* [sol1-C++]

```C++
class Solution {
public:
    int trap(vector<int>& height) {
        int n = height.size();
        if (n == 0) {
            return 0;
        }
        vector<int> leftMax(n);
        leftMax[0] = height[0];
        for (int i = 1; i < n; ++i) {
            leftMax[i] = max(leftMax[i - 1], height[i]);
        }

        vector<int> rightMax(n);
        rightMax[n - 1] = height[n - 1];
        for (int i = n - 2; i >= 0; --i) {
            rightMax[i] = max(rightMax[i + 1], height[i]);
        }

        int ans = 0;
        for (int i = 0; i < n; ++i) {
            ans += min(leftMax[i], rightMax[i]) - height[i];
        }
        return ans;
    }
};
```

* [sol1-C]

```C
int trap(int* height, int heightSize) {
    int n = heightSize;
    if (n == 0) {
        return 0;
    }
    int leftMax[n];
    memset(leftMax, 0, sizeof(leftMax));
    leftMax[0] = height[0];
    for (int i = 1; i < n; ++i) {
        leftMax[i] = fmax(leftMax[i - 1], height[i]);
    }

    int rightMax[n];
    memset(rightMax, 0, sizeof(rightMax));
    rightMax[n - 1] = height[n - 1];
    for (int i = n - 2; i >= 0; --i) {
        rightMax[i] = fmax(rightMax[i + 1], height[i]);
    }

    int ans = 0;
    for (int i = 0; i < n; ++i) {
        ans += fmin(leftMax[i], rightMax[i]) - height[i];
    }
    return ans;
}
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ã€‚è®¡ç®—æ•°ç»„ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ çš„å…ƒç´ å€¼å„éœ€è¦éå†æ•°ç»„ $\textit{height}$ ä¸€æ¬¡ï¼Œè®¡ç®—èƒ½æ¥çš„é›¨æ°´æ€»é‡è¿˜éœ€è¦éå†ä¸€æ¬¡ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ã€‚éœ€è¦åˆ›å»ºä¸¤ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ã€‚

#### æ–¹æ³•äºŒï¼šå•è°ƒæ ˆ

é™¤äº†è®¡ç®—å¹¶å­˜å‚¨æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨å•è°ƒæ ˆè®¡ç®—èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œå•è°ƒæ ˆå­˜å‚¨çš„æ˜¯ä¸‹æ ‡ï¼Œæ»¡è¶³ä»æ ˆåº•åˆ°æ ˆé¡¶çš„ä¸‹æ ‡å¯¹åº”çš„æ•°ç»„ $\textit{height}$ ä¸­çš„å…ƒç´ é€’å‡ã€‚

ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œéå†åˆ°ä¸‹æ ‡ $i$ æ—¶ï¼Œå¦‚æœæ ˆå†…è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œè®°æ ˆé¡¶å…ƒç´ ä¸º $\textit{top}$ï¼Œ$\textit{top}$ çš„ä¸‹é¢ä¸€ä¸ªå…ƒç´ æ˜¯ $\textit{left}$ï¼Œåˆ™ä¸€å®šæœ‰ $\textit{height}[\textit{left}] \ge \textit{height}[\textit{top}]$ã€‚å¦‚æœ $\textit{height}[i]>\textit{height}[\textit{top}]$ï¼Œåˆ™å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ¥é›¨æ°´çš„åŒºåŸŸï¼Œè¯¥åŒºåŸŸçš„å®½åº¦æ˜¯ $i-\textit{left}-1$ï¼Œé«˜åº¦æ˜¯ $\min(\textit{height}[\textit{left}],\textit{height}[i])-\textit{height}[\textit{top}]$ï¼Œæ ¹æ®å®½åº¦å’Œé«˜åº¦å³å¯è®¡ç®—å¾—åˆ°è¯¥åŒºåŸŸèƒ½æ¥çš„é›¨æ°´é‡ã€‚

ä¸ºäº†å¾—åˆ° $\textit{left}$ï¼Œéœ€è¦å°† $\textit{top}$ å‡ºæ ˆã€‚åœ¨å¯¹ $\textit{top}$ è®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ä¹‹åï¼Œ$\textit{left}$ å˜æˆæ–°çš„ $\textit{top}$ï¼Œé‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°æ ˆå˜ä¸ºç©ºï¼Œæˆ–è€…æ ˆé¡¶ä¸‹æ ‡å¯¹åº”çš„ $\textit{height}$ ä¸­çš„å…ƒç´ å¤§äºæˆ–ç­‰äº $\textit{height}[i]$ã€‚

åœ¨å¯¹ä¸‹æ ‡ $i$ å¤„è®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ä¹‹åï¼Œå°† $i$ å…¥æ ˆï¼Œç»§ç»­éå†åé¢çš„ä¸‹æ ‡ï¼Œè®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ã€‚éå†ç»“æŸä¹‹åå³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­ $\textit{height}=[0,1,0,2,1,0,1,3,2,1,2,1]$ æ¥å¸®åŠ©è¯»è€…ç†è§£å•è°ƒæ ˆçš„åšæ³•ã€‚

<![f1](https://assets.leetcode-cn.com/solution-static/42/f1.png),![f2](https://assets.leetcode-cn.com/solution-static/42/f2.png),![f3](https://assets.leetcode-cn.com/solution-static/42/f3.png),![f4](https://assets.leetcode-cn.com/solution-static/42/f4.png),![f5](https://assets.leetcode-cn.com/solution-static/42/f5.png),![f6](https://assets.leetcode-cn.com/solution-static/42/f6.png),![f7](https://assets.leetcode-cn.com/solution-static/42/f7.png),![f8](https://assets.leetcode-cn.com/solution-static/42/f8.png),![f9](https://assets.leetcode-cn.com/solution-static/42/f9.png),![f10](https://assets.leetcode-cn.com/solution-static/42/f10.png),![f11](https://assets.leetcode-cn.com/solution-static/42/f11.png),![f12](https://assets.leetcode-cn.com/solution-static/42/f12.png),![f13](https://assets.leetcode-cn.com/solution-static/42/f13.png),![f14](https://assets.leetcode-cn.com/solution-static/42/f14.png),![f15](https://assets.leetcode-cn.com/solution-static/42/f15.png),![f16](https://assets.leetcode-cn.com/solution-static/42/f16.png),![f17](https://assets.leetcode-cn.com/solution-static/42/f17.png),![f18](https://assets.leetcode-cn.com/solution-static/42/f18.png),![f19](https://assets.leetcode-cn.com/solution-static/42/f19.png),![f20](https://assets.leetcode-cn.com/solution-static/42/f20.png),![f21](https://assets.leetcode-cn.com/solution-static/42/f21.png)>

* [sol2-Java]

```Java
class Solution {
    public int trap(int[] height) {
        int ans = 0;
        Deque<Integer> stack = new LinkedList<Integer>();
        int n = height.length;
        for (int i = 0; i < n; ++i) {
            while (!stack.isEmpty() && height[i] > height[stack.peek()]) {
                int top = stack.pop();
                if (stack.isEmpty()) {
                    break;
                }
                int left = stack.peek();
                int currWidth = i - left - 1;
                int currHeight = Math.min(height[left], height[i]) - height[top];
                ans += currWidth * currHeight;
            }
            stack.push(i);
        }
        return ans;
    }
}
```

* [sol2-Golang]

```go
func trap(height []int) (ans int) {
    stack := []int{}
    for i, h := range height {
        for len(stack) > 0 && h > height[stack[len(stack)-1]] {
            top := stack[len(stack)-1]
            stack = stack[:len(stack)-1]
            if len(stack) == 0 {
                break
            }
            left := stack[len(stack)-1]
            curWidth := i - left - 1
            curHeight := min(height[left], h) - height[top]
            ans += curWidth * curHeight
        }
        stack = append(stack, i)
    }
    return
}

func min(a, b int) int {
    if a < b {
        return a
    }
    return b
}
```

* [sol2-JavaScript]

```JavaScript
var trap = function(height) {
    let ans = 0;
    const stack = [];
    const n = height.length;
    for (let i = 0; i < n; ++i) {
        while (stack.length && height[i] > height[stack[stack.length - 1]]) {
            const top = stack.pop();
            if (!stack.length) {
                break;
            }
            const left = stack[stack.length - 1];
            const currWidth = i - left - 1;
            const currHeight = Math.min(height[left], height[i]) - height[top];
            ans += currWidth * currHeight;
        }
        stack.push(i);
    }
    return ans;
};
```

* [sol2-Python3]

```Python
class Solution:
    def trap(self, height: List[int]) -> int:
        ans = 0
        stack = list()
        n = len(height)
        
        for i, h in enumerate(height):
            while stack and h > height[stack[-1]]:
                top = stack.pop()
                if not stack:
                    break
                left = stack[-1]
                currWidth = i - left - 1
                currHeight = min(height[left], height[i]) - height[top]
                ans += currWidth * currHeight
            stack.append(i)
        
        return ans
```

* [sol2-C++]

```C++
class Solution {
public:
    int trap(vector<int>& height) {
        int ans = 0;
        stack<int> stk;
        int n = height.size();
        for (int i = 0; i < n; ++i) {
            while (!stk.empty() && height[i] > height[stk.top()]) {
                int top = stk.top();
                stk.pop();
                if (stk.empty()) {
                    break;
                }
                int left = stk.top();
                int currWidth = i - left - 1;
                int currHeight = min(height[left], height[i]) - height[top];
                ans += currWidth * currHeight;
            }
            stk.push(i);
        }
        return ans;
    }
};
```

* [sol2-C]

```C
int trap(int* height, int heightSize) {
    int n = heightSize;
    if (n == 0) {
        return 0;
    }
    int ans = 0;
    int stk[n], top = 0;
    for (int i = 0; i < n; ++i) {
        while (top && height[i] > height[stk[top - 1]]) {
            int stk_top = stk[--top];
            if (!top) {
                break;
            }
            int left = stk[top - 1];
            int currWidth = i - left - 1;
            int currHeight = fmin(height[left], height[i]) - height[stk_top];
            ans += currWidth * currHeight;
        }
        stk[top++] = i;
    }
    return ans;
}
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ã€‚ä» $0$ åˆ° $n-1$ çš„æ¯ä¸ªä¸‹æ ‡æœ€å¤šåªä¼šå…¥æ ˆå’Œå‡ºæ ˆå„ä¸€æ¬¡ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºæ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ $n$ã€‚

#### æ–¹æ³•ä¸‰ï¼šåŒæŒ‡é’ˆ

åŠ¨æ€è§„åˆ’çš„åšæ³•ä¸­ï¼Œéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°ç»„ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦æ˜¯ $O(n)$ã€‚æ˜¯å¦å¯ä»¥å°†ç©ºé—´å¤æ‚åº¦é™åˆ° $O(1)$ï¼Ÿ

æ³¨æ„åˆ°ä¸‹æ ‡ $i$ å¤„èƒ½æ¥çš„é›¨æ°´é‡ç”± $\textit{leftMax}[i]$ å’Œ $\textit{rightMax}[i]$ ä¸­çš„æœ€å°å€¼å†³å®šã€‚ç”±äºæ•°ç»„ $\textit{leftMax}$ æ˜¯ä»å·¦å¾€å³è®¡ç®—ï¼Œæ•°ç»„ $\textit{rightMax}$ æ˜¯ä»å³å¾€å·¦è®¡ç®—ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆå’Œä¸¤ä¸ªå˜é‡ä»£æ›¿ä¸¤ä¸ªæ•°ç»„ã€‚

ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆ $\textit{left}$ å’Œ $\textit{right}$ï¼Œä»¥åŠä¸¤ä¸ªå˜é‡ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ï¼Œåˆå§‹æ—¶ $\textit{left}=0,\textit{right}=n-1,\textit{leftMax}=0,\textit{rightMax}=0$ã€‚æŒ‡é’ˆ $\textit{left}$ åªä¼šå‘å³ç§»åŠ¨ï¼ŒæŒ‡é’ˆ $\textit{right}$ åªä¼šå‘å·¦ç§»åŠ¨ï¼Œåœ¨ç§»åŠ¨æŒ‡é’ˆçš„è¿‡ç¨‹ä¸­ç»´æŠ¤ä¸¤ä¸ªå˜é‡ $\textit{leftMax}$ å’Œ $\textit{rightMax}$ çš„å€¼ã€‚

å½“ä¸¤ä¸ªæŒ‡é’ˆæ²¡æœ‰ç›¸é‡æ—¶ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

- ä½¿ç”¨ $\textit{height}[\textit{left}]$ å’Œ $\textit{height}[\textit{right}]$ çš„å€¼æ›´æ–° $\textit{leftMax}$ å’Œ $\textit{rightMax}$ çš„å€¼ï¼›

- å¦‚æœ $\textit{height}[\textit{left}]<\textit{height}[\textit{right}]$ï¼Œåˆ™å¿…æœ‰ $\textit{leftMax}<\textit{rightMax}$ï¼Œä¸‹æ ‡ $\textit{left}$ å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº $\textit{leftMax}-\textit{height}[\textit{left}]$ï¼Œå°†ä¸‹æ ‡ $\textit{left}$ å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† $\textit{left}$ åŠ  $1$ï¼ˆå³å‘å³ç§»åŠ¨ä¸€ä½ï¼‰ï¼›

- å¦‚æœ $\textit{height}[\textit{left}] \ge \textit{height}[\textit{right}]$ï¼Œåˆ™å¿…æœ‰ $\textit{leftMax} \ge \textit{rightMax}$ï¼Œä¸‹æ ‡ $\textit{right}$ å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº $\textit{rightMax}-\textit{height}[\textit{right}]$ï¼Œå°†ä¸‹æ ‡ $\textit{right}$ å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† $\textit{right}$ å‡ $1$ï¼ˆå³å‘å·¦ç§»åŠ¨ä¸€ä½ï¼‰ã€‚

å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œå³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­ $\textit{height}=[0,1,0,2,1,0,1,3,2,1,2,1]$ æ¥å¸®åŠ©è¯»è€…ç†è§£åŒæŒ‡é’ˆçš„åšæ³•ã€‚

<![p1](https://assets.leetcode-cn.com/solution-static/42/p1.png),![p2](https://assets.leetcode-cn.com/solution-static/42/p2.png),![p3](https://assets.leetcode-cn.com/solution-static/42/p3.png),![p4](https://assets.leetcode-cn.com/solution-static/42/p4.png),![p5](https://assets.leetcode-cn.com/solution-static/42/p5.png),![p6](https://assets.leetcode-cn.com/solution-static/42/p6.png),![p7](https://assets.leetcode-cn.com/solution-static/42/p7.png),![p8](https://assets.leetcode-cn.com/solution-static/42/p8.png),![p9](https://assets.leetcode-cn.com/solution-static/42/p9.png),![p10](https://assets.leetcode-cn.com/solution-static/42/p10.png),![p11](https://assets.leetcode-cn.com/solution-static/42/p11.png),![p12](https://assets.leetcode-cn.com/solution-static/42/p12.png)>

* [sol3-Java]

```Java
class Solution {
    public int trap(int[] height) {
        int ans = 0;
        int left = 0, right = height.length - 1;
        int leftMax = 0, rightMax = 0;
        while (left < right) {
            leftMax = Math.max(leftMax, height[left]);
            rightMax = Math.max(rightMax, height[right]);
            if (height[left] < height[right]) {
                ans += leftMax - height[left];
                ++left;
            } else {
                ans += rightMax - height[right];
                --right;
            }
        }
        return ans;
    }
}
```

* [sol3-Golang]

```go
func trap(height []int) (ans int) {
    left, right := 0, len(height)-1
    leftMax, rightMax := 0, 0
    for left < right {
        leftMax = max(leftMax, height[left])
        rightMax = max(rightMax, height[right])
        if height[left] < height[right] {
            ans += leftMax - height[left]
            left++
        } else {
            ans += rightMax - height[right]
            right--
        }
    }
    return
}

func max(a, b int) int {
    if a > b {
        return a
    }
    return b
}
```

* [sol3-JavaScript]

```JavaScript
var trap = function(height) {
    let ans = 0;
    let left = 0, right = height.length - 1;
    let leftMax = 0, rightMax = 0;
    while (left < right) {
        leftMax = Math.max(leftMax, height[left]);
        rightMax = Math.max(rightMax, height[right]);
        if (height[left] < height[right]) {
            ans += leftMax - height[left];
            ++left;
        } else {
            ans += rightMax - height[right];
            --right;
        }
    }
    return ans;
};
```

* [sol3-Python3]

```Python
class Solution:
    def trap(self, height: List[int]) -> int:
        ans = 0
        left, right = 0, len(height) - 1
        leftMax = rightMax = 0

        while left < right:
            leftMax = max(leftMax, height[left])
            rightMax = max(rightMax, height[right])
            if height[left] < height[right]:
                ans += leftMax - height[left]
                left += 1
            else:
                ans += rightMax - height[right]
                right -= 1
        
        return ans
```

* [sol3-C++]

```C++
class Solution {
public:
    int trap(vector<int>& height) {
        int ans = 0;
        int left = 0, right = height.size() - 1;
        int leftMax = 0, rightMax = 0;
        while (left < right) {
            leftMax = max(leftMax, height[left]);
            rightMax = max(rightMax, height[right]);
            if (height[left] < height[right]) {
                ans += leftMax - height[left];
                ++left;
            } else {
                ans += rightMax - height[right];
                --right;
            }
        }
        return ans;
    }
};
```

* [sol3-C]

```C
int trap(int* height, int heightSize) {
    int ans = 0;
    int left = 0, right = heightSize - 1;
    int leftMax = 0, rightMax = 0;
    while (left < right) {
        leftMax = fmax(leftMax, height[left]);
        rightMax = fmax(rightMax, height[right]);
        if (height[left] < height[right]) {
            ans += leftMax - height[left];
            ++left;
        } else {
            ans += rightMax - height[right];
            --right;
        }
    }
    return ans;
}
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ $\textit{height}$ çš„é•¿åº¦ã€‚ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨æ€»æ¬¡æ•°ä¸è¶…è¿‡ $n$ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚åªéœ€è¦ä½¿ç”¨å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚

